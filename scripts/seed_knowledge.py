"""
知识库填充脚本

原则：每条数据都要能直接回答一个真实用户问题。
不是百科式的"瓷砖分为釉面砖、抛光砖..."，
而是"卫生间选瓷砖，防滑等级至少R9，推荐300×300规格，预算60-120元/片"。

用法：
    python scripts/seed_knowledge.py                    # 填充全部
    python scripts/seed_knowledge.py --collection decoration_general  # 填充指定集合
    python scripts/seed_knowledge.py --dry-run           # 仅预览，不写入
"""

import os
import sys
import argparse

# 添加项目根目录到路径
sys.path.insert(0, os.path.dirname(os.path.dirname(os.path.abspath(__file__))))

from backend.knowledge.multi_collection_kb import MultiCollectionKB


# ============================================================
# decoration_general — 装修全流程知识（决策导向）
# ============================================================

DECORATION_GENERAL = [
    # === 准备阶段 ===
    {
        "text": "装修预算怎么定？一般建议按房屋面积估算：简装800-1200元/平米，中档1200-2000元/平米，精装2000-3500元/平米。100平的房子，中档装修大约15-20万。务必预留总预算的10-15%作为机动资金，因为实际装修几乎100%会有增项。",
        "keywords": ["预算", "多少钱", "花多少"],
        "category": "budget",
    },
    {
        "text": "装修第一步该做什么？不是找装修公司，而是先想清楚三件事：①你家几口人住、有没有老人小孩（决定功能需求）②预算上限是多少（决定材料档次）③大概喜欢什么风格（决定设计方向）。这三个问题想清楚了，后面所有决策都有依据。",
        "keywords": ["第一步", "从哪开始", "怎么入手"],
        "category": "preparation",
    },
    {
        "text": "装修全流程及时间线：①前期准备1-2周（定预算、选风格、找设计师）②设计阶段2-4周（量房、出方案、确认）③拆改1-2周 ④水电改造1-2周 ⑤防水+瓦工3-4周 ⑥木工+油漆3-4周 ⑦安装阶段1-2周（橱柜、门、地板、灯具）⑧软装+通风1-2周。100平的房子，正常工期3-4个月。",
        "keywords": ["流程", "步骤", "多久", "工期"],
        "category": "process",
    },
    {
        "text": "半包vs全包怎么选？半包：自己买主材（瓷砖、地板、橱柜等），施工方负责辅材和人工。优点是主材自己把控质量和价格，缺点是要花大量时间跑建材市场。全包：所有材料和施工都交给装修公司。优点是省心，缺点是主材品牌和型号可能被偷换。建议：如果你有时间精力，选半包更省钱；如果实在没时间，选全包但一定要在合同里写明每项主材的品牌、型号、数量。",
        "keywords": ["半包", "全包", "清包", "怎么选"],
        "category": "preparation",
    },
    {
        "text": "装修合同必须注意的5个条款：①付款方式：建议3-3-3-1（开工30%、水电完30%、油漆完30%、验收10%），绝不要一次付超过50%。②增项上限：合同约定增项不超过总价的8-10%。③工期约定：明确开工和竣工日期，逾期赔偿标准。④验收标准：每个节点的验收标准写清楚。⑤保修条款：防水保修5年，其他工程保修2年。",
        "keywords": ["合同", "注意事项", "付款"],
        "category": "contract",
    },
    {
        "text": "找装修公司还是施工队？装修公司：有设计、有项目经理、有售后，但价格贵20-30%。施工队：价格便宜，但需要自己盯工地、协调各工种。建议：10万以下预算或局部翻新选施工队；15万以上或全屋装修选装修公司。无论选哪个，都要看实际完工案例，最好能联系到之前的业主问问真实体验。",
        "keywords": ["装修公司", "施工队", "怎么找"],
        "category": "preparation",
    },

    # === 设计阶段 ===
    {
        "text": "怎么判断设计方案好不好？看三个核心指标：①动线合理性——从玄关到客厅到厨房到卧室，日常走动路线是否顺畅，有没有绕路。②收纳充足性——一家三口至少需要12-15立方米收纳空间，看方案里有没有足够的柜子。③采光通风——主要活动区域（客厅、主卧）是否朝南或有大窗，厨卫是否有排风。",
        "keywords": ["设计方案", "好不好", "怎么看"],
        "category": "design",
    },
    {
        "text": "装修风格怎么选？不要被名词迷惑，核心是两个维度：①色调偏好——喜欢暖色（奶油、原木）还是冷色（灰白、黑白）②线条偏好——喜欢简洁直线还是有弧度曲线。暖色+简洁=现代简约/奶油风；冷色+简洁=极简/侘寂风；暖色+曲线=法式/美式；冷色+直线=工业风。小户型（90平以下）建议选浅色系+简洁线条，显大。",
        "keywords": ["风格", "选什么风格", "现代简约", "奶油风"],
        "category": "design",
    },
    {
        "text": "设计师报价怎么看？设计费一般按面积收：普通设计师80-150元/平米，知名设计师200-500元/平米。100平的房子设计费8000-15000元是正常的。注意：有些装修公司说'免费设计'，其实设计费包含在施工费里了，而且设计质量通常一般。好的设计能帮你省下远超设计费的装修费用。",
        "keywords": ["设计费", "设计师", "多少钱"],
        "category": "design",
    },

    # === 施工阶段 ===
    {
        "text": "水电改造是最容易被坑的环节。注意事项：①走线原则——横平竖直，强弱电间距30cm以上，强弱电交叉处用锡纸包裹。②点位规划——厨房至少8-10个插座，卫生间马桶旁留插座（智能马桶盖），床头两侧双控开关。③验收标准——打压测试0.8MPa保持30分钟不掉压。④一定要拍照留存所有管线走向，后期挂东西不会打到管线。",
        "keywords": ["水电", "改造", "注意", "插座"],
        "category": "construction",
    },
    {
        "text": "防水怎么验收？防水是装修中最不能省的环节，漏水了楼下找你赔偿更麻烦。标准做法：①卫生间墙面防水高度≥1.8米（淋浴区），其他区域≥0.3米。②厨房防水高度≥0.3米。③阳台如果有洗衣机，也要做防水。④闭水试验：蓄水深度≥3cm，保持48小时，到楼下检查有无渗漏。⑤防水材料建议用柔性防水涂料（如东方雨虹、德高），不要用防水卷材。",
        "keywords": ["防水", "闭水试验", "漏水"],
        "category": "construction",
    },
    {
        "text": "瓷砖空鼓怎么判断？用空鼓锤或硬币敲击瓷砖表面，声音清脆的是空鼓，声音沉闷的是实贴。验收标准：①单块瓷砖空鼓面积不超过该砖面积的15%。②整面墙/地空鼓率不超过5%。③边角空鼓必须返工（容易翘起）。④淋浴区和地面砖不允许有空鼓（踩裂风险）。发现空鼓要在瓷砖胶未完全固化前（48小时内）要求返工。",
        "keywords": ["空鼓", "瓷砖", "验收"],
        "category": "construction",
    },
    {
        "text": "墙面施工验收标准：①平整度——用2米靠尺检查，误差不超过3mm。②阴阳角——用角尺检查，误差不超过3mm。③乳胶漆——无流坠、无刷痕、颜色均匀、无色差。④腻子层——至少刮2-3遍，每遍干透后再刮下一遍。⑤底漆——必须刷底漆，防止墙面返碱发霉。常见问题：墙面开裂多因腻子层太厚或未干透就刷漆。",
        "keywords": ["墙面", "乳胶漆", "验收", "开裂"],
        "category": "construction",
    },

    # === 选材通用知识 ===
    {
        "text": "瓷砖怎么选？按空间选：①客厅——800×800或750×1500大砖，抛釉砖或通体大理石瓷砖，预算80-200元/片。②卫生间地面——300×300防滑砖，防滑等级≥R9，预算30-80元/片。③卫生间墙面——300×600釉面砖，吸水率≤10%，预算20-60元/片。④厨房——300×600釉面砖，耐油污易清洁。⑤阳台——仿古砖或木纹砖，防滑耐磨。品牌参考：一线（马可波罗、东鹏、诺贝尔）、性价比（蒙娜丽莎、冠珠、欧神诺）。",
        "keywords": ["瓷砖", "怎么选", "品牌"],
        "category": "material",
    },

    # === 瓷砖深度决策知识（配合决策树使用）===
    {
        "text": "客厅瓷砖选购指南：客厅是家里面积最大、使用频率最高的空间，瓷砖选择直接决定整体装修效果。规格推荐：大户型（≥100平）选800×800或750×1500大砖，缝少显大气；小户型（<100平）选600×600或600×1200。材质推荐：通体大理石瓷砖（纹理通透、耐磨）或抛釉砖（光泽度好、花色多）。有地暖的客厅选导热性好的瓷砖（厚度≤10mm），避免选太厚的仿古砖。预算参考：经济型60-120元/片，中档120-250元/片，高端250元以上。",
        "keywords": ["客厅", "瓷砖", "大砖", "规格"],
        "category": "material_tile",
    },
    {
        "text": "卫生间瓷砖选购指南：卫生间选砖核心是防滑和防水。地砖：必须选防滑砖，防滑等级≥R9（最好R10），推荐哑光面或拉槽面，规格300×300最常用。墙砖：吸水率≤10%的釉面砖，规格300×600或400×800。颜色建议选浅色系（白色、浅灰、米色），显得干净明亮。深色砖容易显水渍。有老人的家庭，地砖防滑等级建议R11以上。预算参考：地砖30-80元/片，墙砖20-60元/片。",
        "keywords": ["卫生间", "瓷砖", "防滑", "墙砖", "地砖"],
        "category": "material_tile",
    },
    {
        "text": "厨房瓷砖选购指南：厨房瓷砖核心要求是耐油污、易清洁。墙砖推荐亮面釉面砖（油污一擦就掉），不要选哑光面（油渍渗进去擦不掉）。地砖要防滑但不要选纹理太深的（藏油污）。规格：墙砖300×600最主流，地砖300×300。颜色建议浅色（白色、浅灰），深色砖在厨房容易显脏。如果厨房面积小（<6平米），墙地砖用同色系会显大。预算参考：厨房瓷砖总花费一般3000-8000元。",
        "keywords": ["厨房", "瓷砖", "耐油污", "易清洁"],
        "category": "material_tile",
    },
    {
        "text": "阳台瓷砖选购指南：阳台选砖取决于用途。晾衣服/放洗衣机的阳台：必须防滑防水，选仿古砖或通体砖，防滑等级≥R10。休闲阳台/茶室：可以选木纹砖（有木地板效果但不怕水），规格150×900或200×1000。封闭阳台当书房：可以和室内通铺同款砖。注意：如果阳台没有封闭，必须选吸水率≤0.5%的瓷砖（防冻裂）。预算参考：阳台面积小，总花费一般1000-3000元。",
        "keywords": ["阳台", "瓷砖", "防滑", "木纹砖"],
        "category": "material_tile",
    },
    {
        "text": "有地暖的家庭怎么选瓷砖？地暖对瓷砖有三个要求：①导热性好——瓷砖本身导热性优于木地板，这是地暖房选瓷砖的天然优势。②厚度适中——建议≤10mm，太厚影响导热效率。③热膨胀系数小——通体砖和抛釉砖都可以，避免选微晶石（容易热胀冷缩开裂）。铺贴注意：地暖房必须用瓷砖胶铺贴（不能用水泥砂浆，容易空鼓），留缝≥2mm（热胀冷缩需要空间）。",
        "keywords": ["地暖", "瓷砖", "导热", "铺贴"],
        "category": "material_tile",
    },
    {
        "text": "瓷砖品牌怎么选？按预算分三档：一线品牌（马可波罗、东鹏、诺贝尔、蒙娜丽莎）——品质稳定、花色丰富、售后好，但价格贵20-30%。二线品牌（冠珠、欧神诺、金意陶、新中源）——性价比高，品质接近一线，适合大面积使用。三线/工程砖——价格最低但品控不稳定，不建议用在客厅和卫生间。选购建议：客厅和卫生间用一线或二线品牌，厨房和阳台可以用二线品牌省预算。同品牌不同系列价差很大，重点看具体产品参数而不是只看品牌。",
        "keywords": ["瓷砖", "品牌", "马可波罗", "东鹏", "诺贝尔"],
        "category": "material_tile",
    },
    {
        "text": "瓷砖用量怎么算？计算公式：用量=铺贴面积÷单片面积×1.05（5%损耗）。常见规格换算：800×800=0.64㎡/片，600×600=0.36㎡/片，300×600=0.18㎡/片，300×300=0.09㎡/片。���例：客厅30平米铺800×800瓷砖，需要30÷0.64×1.05≈50片。卫生间地面5平米铺300×300，需要5÷0.09×1.05≈59片。注意：异形铺贴（如菱形铺、人字铺）损耗率要按10-15%算。买砖时建议多买5-10片备用，同批次色号一致，后期补货可能有色差。",
        "keywords": ["瓷砖", "用量", "多少片", "怎么算"],
        "category": "material_tile",
    },
    {
        "text": "瓷砖铺贴方式怎么选？常见铺法：①正铺（横平竖直）——最省砖、最便宜，适合大部分空间。②菱形铺（45度斜铺）——视觉效果好但损耗大（多15%），人工费也贵。③人字铺——适合长条砖，有层次感，损耗约10%。④工字铺（错缝铺）——类似砌墙效果，适合地铁砖和长条砖。⑤通铺（无缝或微缝）——大砖通铺效果大气，但对施工精度要求高。小户型建议正铺或通铺（显大），大户型可以尝试人字铺或菱形铺（有设计感）。",
        "keywords": ["瓷砖", "铺贴", "铺法", "人字铺", "菱形"],
        "category": "material_tile",
    },
    {
        "text": "家有小孩怎么选瓷砖？三个核心要求：①防滑——客厅和卫生间地砖防滑等级≥R10，小孩跑动多容易滑倒。②环保——瓷砖本身不含甲醛（比木地板安全），但要注意美缝剂选环保型的。③耐磨——小孩玩玩具容易刮花地面，选莫氏硬度≥6的瓷砖（通体砖、抛釉砖都可以）。额外建议：避免选深色亮面砖（容易显划痕），浅色哑光砖更耐看。客厅可以局部铺地毯增加缓冲。",
        "keywords": ["小孩", "儿童", "瓷砖", "防滑", "安全"],
        "category": "material_tile",
    },
    {
        "text": "家有老人怎么选瓷砖？老人防滑是第一优先级。卫生间地砖防滑等级必须≥R11（最高级），推荐拉槽面或粗面砖。客厅地砖选哑光面，不要选亮面抛光砖（湿了极滑）。门槛石和过门石要做防滑处理。额外建议：卫生间门口放防滑垫，淋浴区做拉槽地面（水能快速排走）。颜色选浅色系，老人视力下降后深色地面容易看不清障碍物。",
        "keywords": ["老人", "瓷砖", "防滑", "安全", "适老"],
        "category": "material_tile",
    },
    {
        "text": "不同风格适合什么瓷砖？①现代简约——大规格纯色砖或浅色大理石纹砖，颜色以白、灰、米为主，通铺效果最好。②奶油风/日式——暖色调微水泥砖或木纹砖，色温偏暖（米白、奶咖），避免冷灰色。③侘寂风——微水泥砖、艺术砖，颜色低饱和度（灰棕、灰绿），纹理要有手工感。④中式/新中式——仿石纹砖或深色木纹砖，可以局部用花砖做点缀。⑤工业风——水泥砖、做旧砖，颜色以灰色系为主。选砖时带一块样品回家，在自然光下看效果，店里的灯光会让砖显得比实际好看。",
        "keywords": ["风格", "瓷砖", "现代简约", "奶油风", "侘寂"],
        "category": "material_tile",
    },

    # === 地板深度决策知识 ===
    {
        "text": "三层实木复合地板为什么是地暖房的最佳选择？三层实木复合=表层实木（2-4mm）+中间层交叉拼接+底层平衡层。优势：①稳定性好——交叉结构抵消了木材的热胀冷缩，不易变形。②导热性适中——比纯实木导热快，比强化地板脚感好。③环保——用胶量比多层实木少，甲醛释放更低。④脚感——表层是真实木，赤脚踩上去温润舒适。价格参考：国产品牌200-400元/㎡，进口品牌400-800元/㎡。推荐品牌：大自然、圣象、德尔、久盛。",
        "keywords": ["三层实木", "复合地板", "地暖", "推荐"],
        "category": "material_floor",
    },
    {
        "text": "地板环保等级怎么看？2021年新国标GB/T 36900将地板甲醛释放分为三个等级：E1级（≤0.124mg/m3）——国标最低要求，合格但不推荐卧室使用。E0级（≤0.050mg/m3）——推荐等级，适合大部分家庭。ENF级（≤0.025mg/m3）——最高等级，适合有小孩或对环保要求高的家庭。注意：商家说的'E0'要看是哪个标准，有些用的是欧标（和国标数值不同）。最靠谱的方法是看检测报告上的具体数值，而不是只看等级标签。",
        "keywords": ["地板", "环保", "甲醛", "E0", "ENF"],
        "category": "material_floor",
    },

    # === 施工验收深度知识 ===
    {
        "text": "水电验收完整清单：①强电——所有开关插座通电测试，用验电器逐个检查。②弱电——网线用测线仪测试，电视线用信号测试。③水路——打压测试0.8MPa保持30分钟，压力表读数下降≤0.05MPa为合格。④排水——每个地漏和下水口倒水测试，观察排水速度和有无渗漏。⑤走线规范——强弱电间距≥30cm，交叉处有锡纸屏蔽。⑥管线固定——每隔60-80cm有管卡固定，不能有悬空段。⑦拍照存档——所有管线走向拍照，标注尺寸，后期装修挂东西不会打到管线。",
        "keywords": ["水电", "验收", "打压", "清单"],
        "category": "construction_inspection",
    },
    {
        "text": "瓦工验收完整清单：①空鼓检测——用空鼓锤逐块敲击，空鼓率≤5%，边角不允许空鼓。②平整度——2米靠尺检查，误差≤2mm。③缝隙均匀——砖缝宽度一致，十字缝对齐。④阴阳角——角尺检查，误差≤3mm。⑤坡度——卫生间地面向地漏方向找坡，坡度1-1.5%，倒水测试水能顺利流向地漏。⑥墙砖——垂直度误差≤2mm，无明显色差。⑦踢脚线——与墙面贴合紧密，无翘起。验收时间：贴完砖24小时后、美缝之前验收最佳。",
        "keywords": ["瓦工", "验收", "空鼓", "平整度"],
        "category": "construction_inspection",
    },
    {
        "text": "地板怎么选？三种主流地板对比：①实木地板——脚感最好，但怕水怕潮，不适合地暖，价格200-800元/平米。②实木复合地板——性价比最高，适合地暖，脚感接近实木，价格150-400元/平米。③强化复合地板——最耐磨最便宜，但脚感硬，价格60-200元/平米。有地暖的家庭建议选实木复合或SPC锁扣地板。环保等级认准ENF级（甲醛释放≤0.025mg/m3）或E0级。",
        "keywords": ["地板", "怎么选", "实木", "复合", "地暖"],
        "category": "material",
    },
    {
        "text": "橱柜怎么选？橱柜=柜体+门板+台面+五金。①柜体：多层实木板或颗粒板，认准ENF或E0级。②门板：吸塑门板（便宜耐用）、烤漆门板（好看但怕磕碰）、实木门板（贵）。③台面：石英石最主流，厚度≥15mm，硬度≥莫氏6级。④五金：铰链和抽屉滑轨是橱柜寿命的关键，认准百隆（Blum）或海蒂诗（Hettich）。整体橱柜价格参考：经济型800-1500元/延米，中档1500-3000元/延米。注意：橱柜定制周期25-35天，要在施工前就定好。",
        "keywords": ["橱柜", "怎么选", "台面", "定制"],
        "category": "material",
    },
    {
        "text": "卫浴怎么选？①马桶：虹吸式（安静）vs直冲式（不易堵），建议选虹吸式。关注冲水量（≤4.8L为节水型）和釉面（纳米釉面不挂污）。品牌参考：TOTO、科勒、箭牌。②花洒：看出水方式和恒温功能，恒温花洒能防止忽冷忽热。③浴室柜：台上盆好看但不好打理，台下盆实用。柜体要选防潮板材。预算参考：马桶1000-3000元，花洒套装500-2000元，浴室柜1500-4000元。",
        "keywords": ["卫浴", "马桶", "花洒", "浴室柜"],
        "category": "material",
    },
    {
        "text": "涂料怎么选？墙面涂料看三个指标：①环保性——认准十环认证或法国A+认证，VOC含量越低越好。②遮盖力——一般刷2遍面漆能完全遮盖底色。③耐擦洗——好的乳胶漆耐擦洗次数≥10000次。品牌参考：进口（芬琳、都芳、本杰明摩尔），国产（立邦、多乐士、三棵树）。价格参考：国产中档300-500元/桶（15L，刷40-50平米），进口600-1200元/桶。注意：底漆不能省，防止墙面返碱和提高面漆附着力。",
        "keywords": ["涂料", "乳胶漆", "环保", "品牌"],
        "category": "material",
    },

    # === 避坑指南 ===
    {
        "text": "装修最容易踩的5个坑：①水电增项——开工前说好的价格，水电做完多出好几万。防坑：合同约定水电按实结算的上限。②偷换材料——合同写的一线品牌，实际用的杂牌。防坑：每批材料进场都要核对品牌型号。③工期拖延——说好3个月，拖到半年。防坑：合同约定逾期赔偿。④隐蔽工程偷工减料——防水少刷一遍、电线用细的。防坑：隐蔽工程必须到场验收。⑤尾款付完就不管了——售后找不到人。防坑：留10%尾款，验收合格后再付。",
        "keywords": ["避坑", "被坑", "注意", "陷阱"],
        "category": "pitfall",
    },
    {
        "text": "熟人装修要注意什么？很多人觉得找熟人装修靠谱又便宜，但实际上熟人装修是纠纷高发区。建议：①一样要签正式合同，把所有条款写清楚。②一样要明确验收标准，不能因为是熟人就不好意思提要求。③付款方式和陌生人一样，按节点付款。④出了问题要及时沟通，不要碍于面子拖着不说。⑤如果实在不好意思谈钱，那就别找熟人。",
        "keywords": ["熟人", "朋友", "亲戚", "装修"],
        "category": "pitfall",
    },
    {
        "text": "哪些地方可以省钱，哪些绝对不能省？可以省的：①吊顶——简单走一圈石膏线就够了，复杂吊顶既贵又压层高。②背景墙——乳胶漆+挂画比大理石背景墙省几万。③灯具——网购比实体店便宜50%以上。④软装——可以慢慢添置，不必一步到位。绝对不能省的：①水电材料——电线用4平方铜芯线，水管用PPR管。②防水——材料和施工都不能省。③五金件——铰链、角阀、地漏，差的用半年就坏。④床垫——每天睡8小时，直接影响健康。",
        "keywords": ["省钱", "哪里省", "不能省"],
        "category": "pitfall",
    },

    # === 软装入住 ===
    {
        "text": "软装搭配基本原则：①色彩631法则——主色占60%（墙面、大件家具）、辅色占30%（窗帘、地毯、小家具）、点缀色占10%（抱枕、装饰画、花瓶）。②大件先定——先选沙发和床，再选其他家具，最后选配饰。③尺寸先量——买家具前量好空间尺寸，预留通道宽度（主通道≥80cm，次通道≥60cm）。④灯光分层——主灯+射灯+灯带+台灯，不同场景不同氛围。",
        "keywords": ["软装", "搭配", "颜色", "家具"],
        "category": "softdecor",
    },
    {
        "text": "新房入住前必做的3件事：①甲醛检测——找CMA认证的专业机构检测，不要用网上买的甲醛试纸（误差极大）。国标是≤0.08mg/m3。②通风——至少3个月，夏天高温通风效果最好（甲醛在高温下释放更快）。开窗通风比放绿植、活性炭有效100倍。③全屋保洁——开荒保洁建议请专业团队，100平大约300-500元。自己做容易划伤地板和台面。",
        "keywords": ["入住", "甲醛", "通风", "多久"],
        "category": "movein",
    },
]


# ============================================================
# dongju_c_end — 洞居C端使用指南（补贴、逛店、交易）
# ============================================================

DONGJU_C_END = [
    {
        "text": "洞居平台补贴政策：在洞居合作商家消费可享受补贴返现。补贴比例按品类不同：家具5%（上限2000元）、建材3%（上限1500元）、家电4%（上限1000元）、软装6%（上限800元）、智能家居8%（上限1500元）。每月补贴上限5000元。补贴在交易完成并核销后发放到账户余额。",
        "keywords": ["补贴", "返现", "多少", "比例"],
        "category": "subsidy",
    },
    {
        "text": "怎么在洞居领补贴？完整流程：1.在平台发布装修需求 2.浏览推荐商家，选择心仪的店 3.到店消费时出示洞居优惠券或二维码 4.商家扫码确认交易 5.平台审核通过后补贴到账（一般3-7个工作日）。注意：必须通过平台二维码核销才能享受补贴，私下交易无法补贴。",
        "keywords": ["怎么领", "补贴流程", "核销"],
        "category": "subsidy",
    },
    {
        "text": "洞居补贴计算示例：买了一套8000元的沙发（家具类），补贴=8000x5%=400元。买了5000元的瓷砖（建材类），补贴=5000x3%=150元。同一个月内，家具补贴400+建材补贴150=550元，未超过月度5000元上限，全额发放。",
        "keywords": ["补贴", "计算", "举例", "算一下"],
        "category": "subsidy",
    },
    {
        "text": "洞居逛店指南：平台会根据你的装修需求和位置推荐附近的合作商家。建议逛店策略：1.先在平台上看商家评分和评价，筛选评分4.0以上的 2.同品类至少对比3家 3.到店后先不急着买，记录各家的报价和产品型号 4.回来用平台的比价功能对比 5.确定后再到店成交并核销。",
        "keywords": ["逛店", "怎么逛", "比价", "推荐"],
        "category": "shopping",
    },
    {
        "text": "洞居平台交易纠纷怎么办？如果和商家发生纠纷：1.先在平台上联系商家客服协商 2.协商不成可以申请平台介入 3.保留好所有交易凭证（合同、收据、聊天记录、照片）4.平台会在3个工作日内给出处理方案。商家入驻时缴纳了5000元保证金，用于保障消费者权益。",
        "keywords": ["纠纷", "投诉", "退款", "维权"],
        "category": "transaction",
    },
    {
        "text": "洞居平台怎么发布装修需求？发布需求能让商家主动联系你，还能获得更精准的推荐。发布时建议填写：装修品类、预算范围、偏好风格、房屋面积和户型、期望的服务区域。需求描述越详细，匹配的商家越精准。发布后通常1-3天内会有商家联系你。",
        "keywords": ["发布需求", "怎么发", "想法"],
        "category": "demand",
    },
    {
        "text": "洞居平台的商家靠谱吗？平台对入驻商家有审核机制：营业执照和资质证书审核、缴纳5000元保证金、用户评价公开透明、差评商家会被降权甚至清退。建议选择评分4.0以上、评价数50条以上、入驻时间超过6个月的商家。平台上的评价比较真实，因为只有实际交易过的用户才能评价。",
        "keywords": ["商家", "靠谱", "信任", "评价"],
        "category": "trust",
    },
]


# ============================================================
# dongju_b_end — 洞居B端商家运营指南
# ============================================================

DONGJU_B_END = [
    {
        "text": "洞居商家入驻条件和费用：需要营业执照（家居建材相关），缴纳保证金5000元（可退），平台服务费按成交金额的3%收取，推广费最低充值1000元（按效果付费CPC/CPA）。入驻流程：提交资料、平台审核（1-3个工作日）、缴纳保证金、店铺上线。",
        "keywords": ["入驻", "条件", "费用", "保证金"],
        "category": "onboarding",
    },
    {
        "text": "洞居商家怎么提高转化率？平台数据显示，转化率TOP商家的共同特点：首次响应时间小于5分钟（响应快的商家转化率高30%）、店铺有真实案例图片（至少10张实景图）、报价透明（提供详细的材料清单和单价明细）、评分4.5以上。建议新入驻商家先做好这四点基础工作。",
        "keywords": ["转化率", "提高", "获客", "成交"],
        "category": "marketing",
    },
    {
        "text": "洞居商家ROI怎么算？ROI=（成交收入-平台费用-推广费用）/总投入x100%。举例：某商家月投入5000元（推广3000+服务费2000），月成交10单共15万元，服务费15万x3%=4500元，ROI=（150000-4500-3000）/7500=1900%。行业基准：ROI大于200%为优秀，大于100%为良好，小于50%需要优化策略。",
        "keywords": ["ROI", "投入产出", "回报率", "划算"],
        "category": "analytics",
    },
    {
        "text": "洞居商家结算规则：标准结算周期T+7（交易完成后7天到账），快速结算T+1（需额外申请）。结算金额=成交金额-平台服务费（3%）。每月1日和15日为固定结算日。退款会相应扣减已结算佣金。对账可在商家后台查看详细的交易明细和结算报表。",
        "keywords": ["结算", "到账", "周期", "佣金"],
        "category": "settlement",
    },
    {
        "text": "洞居商家获客话术建议：首次联系客户时，不要上来就推销产品。建议话术：您好，我是XX品牌的某某，看到您在洞居平台上发布了某品类的需求。我们店在某位置，专做该品类已经X年了。方便的话我先发几个和您户型类似的案例给您参考？关键点：表明身份和专业性、不急于报价、先提供价值建立信任。",
        "keywords": ["话术", "怎么联系", "客户", "沟通"],
        "category": "marketing",
    },
    {
        "text": "洞居商家核销操作指南：客户到店消费后，核销步骤：打开商家版APP、扫描客户出示的洞居二维码、确认交易金额和品类、双方确认后提交。常见问题：扫码失败检查网络连接和APP版本；金额有误可在提交前修改；客户忘带手机可用手机号查询核销码。核销后补贴会在审核通过后发放给客户。",
        "keywords": ["核销", "扫码", "操作", "怎么核销"],
        "category": "settlement",
    },
    {
        "text": "洞居商家经营数据怎么看？商家后台提供以下核心数据：曝光量（店铺被多少用户看到）、咨询量（多少用户主动联系你）、到店量（多少用户实际到店）、成交量和成交额、转化漏斗（从曝光到成交每一步的转化率）。重点关注咨询到到店和到店到成交两个转化率，这是最能优化的环节。",
        "keywords": ["数据", "后台", "报表", "分析"],
        "category": "analytics",
    },
]


# ============================================================
# smart_home — 智能家居选购指南
# ============================================================

SMART_HOME = [
    {
        "text": "智能家居入门三件套：1.智能门锁——指纹+密码+NFC，推荐品牌小米、德施曼、凯迪仕，价格1000-3000元。2.智能音箱——作为全屋智能中控，推荐小爱同学或天猫精灵，价格200-500元。3.智能灯光——支持调色温和亮度，推荐Yeelight或飞利浦Hue。这三样投入不大但体验提升明显。",
        "keywords": ["智能家居", "入门", "推荐", "哪些"],
        "category": "smart_home",
    },
    {
        "text": "智能家居生态怎么选？目前主流三大生态：米家（小米）产品最多最便宜，适合预算有限的用户。HomeKit（苹果）体验最好但产品贵，适合苹果全家桶用户。华为HiLink产品质量好，适合华为手机用户。建议不要混用生态，选一个生态深入使用。装修时预留零火线开关底盒（智能开关需要零线）。",
        "keywords": ["生态", "米家", "苹果", "华为", "选哪个"],
        "category": "smart_home",
    },
    {
        "text": "装修时为智能家居预留什么？每个开关位预留零线（智能开关必需）、弱电箱预留足够空间（放路由器和智能网关）、每个房间至少2个网线口、窗帘盒内预留电源（电动窗帘）、马桶旁预留插座（智能马桶盖）、入户门预留电源（可视门铃需要电源）、客厅预留投影仪电源和HDMI线管。",
        "keywords": ["预留", "布线", "装修", "智能"],
        "category": "smart_home",
    },
]


# ============================================================
# merchant_info — 商家信息与选购技巧
# ============================================================

MERCHANT_INFO = [
    {
        "text": "选择建材商家的5个标准：1.品牌授权——要求商家出示品牌授权书，防止买到假货。2.实体展厅——有实体展厅的商家更靠谱，可以实际看到产品效果。3.售后保障——问清楚退换货政策和质保期限。4.安装服务——是否包安装，安装费怎么算。5.口碑评价——看平台评价和实际案例，重点看差评内容。",
        "keywords": ["选商家", "怎么选", "靠谱"],
        "category": "merchant",
    },
    {
        "text": "建材市场砍价技巧：先不表露购买意向说随便看看。同品类至少比3家，记录各家报价。标价通常有30-50%的砍价空间（尤其是瓷砖和卫浴）。问最低多少能做比直接砍价更有效。大批量采购（如全屋瓷砖）可以要求额外折扣��关注节假日促销和品牌活动日。",
        "keywords": ["砍价", "便宜", "折扣", "怎么谈"],
        "category": "merchant",
    },
]


# ============================================================
# 主执行逻辑
# ============================================================

ALL_COLLECTIONS = {
    "decoration_general": DECORATION_GENERAL,
    "dongju_c_end": DONGJU_C_END,
    "dongju_b_end": DONGJU_B_END,
    "smart_home": SMART_HOME,
    "merchant_info": MERCHANT_INFO,
}


def seed_collection(kb, collection_name, entries, dry_run=False):
    """填充单个集合"""
    print(f"\n{'='*60}")
    print(f"填充集合: {collection_name} ({len(entries)} 条)")
    print(f"{'='*60}")

    success = 0
    skipped = 0
    failed = 0

    for i, entry in enumerate(entries):
        text = entry["text"]
        keywords = entry.get("keywords", [])
        category = entry.get("category", "general")

        preview = text[:80].replace("\n", " ")
        if dry_run:
            print(f"  [{i+1}] {preview}...")
            success += 1
            continue

        try:
            result = kb.add_text(
                collection_name=collection_name,
                text=text,
                source="seed_knowledge",
                category=category,
                target_user="both",
                priority=3,
                keywords=keywords,
                operator="seed_script",
            )
            if "跳过" in result:
                skipped += 1
                print(f"  [{i+1}] 跳过（已存在）: {preview}...")
            elif "错误" in result:
                failed += 1
                print(f"  [{i+1}] 失败: {result}")
            else:
                success += 1
                print(f"  [{i+1}] OK {preview}...")
        except Exception as e:
            failed += 1
            print(f"  [{i+1}] 异常: {e}")

    print(f"\n  结果: 成功 {success} | 跳过 {skipped} | 失败 {failed}")
    return success, skipped, failed


def main():
    parser = argparse.ArgumentParser(description="DecoPilot 知识库填充脚本")
    parser.add_argument("--collection", type=str, default=None,
                        help="指定填充的集合名称，不指定则填充全部")
    parser.add_argument("--dry-run", action="store_true",
                        help="仅预览，不实际写入")
    args = parser.parse_args()

    if args.dry_run:
        print("预览模式（不写入数据库）\n")
    else:
        print("开始填充知识库...\n")

    kb = MultiCollectionKB()

    total_success = 0
    total_skipped = 0
    total_failed = 0

    if args.collection:
        if args.collection not in ALL_COLLECTIONS:
            print(f"错误: 集合 {args.collection} 不存在。可用: {list(ALL_COLLECTIONS.keys())}")
            return
        entries = ALL_COLLECTIONS[args.collection]
        s, sk, f = seed_collection(kb, args.collection, entries, args.dry_run)
        total_success += s
        total_skipped += sk
        total_failed += f
    else:
        for coll_name, entries in ALL_COLLECTIONS.items():
            s, sk, f = seed_collection(kb, coll_name, entries, args.dry_run)
            total_success += s
            total_skipped += sk
            total_failed += f

    print(f"\n{'='*60}")
    print(f"总计: 成功 {total_success} | 跳过 {total_skipped} | 失败 {total_failed}")
    print(f"{'='*60}")


if __name__ == "__main__":
    main()
